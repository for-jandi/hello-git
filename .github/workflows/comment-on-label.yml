# .github/workflows/comment-on-order-label.yml
name: Comment on `order` PR labels

on:
  pull_request:
    types: [labeled]

jobs:
  comment-on-order:
    runs-on: ubuntu-latest
    steps:
      - name: Comment if `order` label and method exist
        uses: actions/github-script@v7
        with:
          script: |
            const { owner, repo } = context.repo;
            const pr = context.payload.pull_request;
            const labels = pr.labels.map(label => label.name.toLowerCase());
            const moduleLabel = 'backoffice';
            const methodLabels = ['get', 'post', 'put', 'delete'];

            if (!labels.includes(moduleLabel)) {
              console.log(moduleLabel + ' 라벨이 없는 PR입니다. 종료합니다.');
              return;
            }

            const matchedMethod = methodLabels.find(m => labels.includes(m));
            if (!matchedMethod) {
              console.log('HTTP 메서드 라벨이 없습니다. 종료합니다.');
              return;
            }

            const commentBody = `
### 🚀 Order PR 알림

\`${moduleLabel}\`에 대한 **\`${matchedMethod.toUpperCase()}\` 요청** 변경이 감지되었습니다.

- PR: [#${pr.number}](${pr.html_url})
- 브랜치: \`${pr.head.ref}\` → \`${pr.base.ref}\`
- 작성자: @${pr.user.login}

검토 부탁드립니다 🙏
`;

            await github.rest.issues.createComment({
              owner,
              repo,
              issue_number: pr.number,
              body: commentBody,
            });

            console.log('코멘트를 작성했습니다.');
