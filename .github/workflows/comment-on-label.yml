# .github/workflows/comment-on-order-label.yml
name: Comment on `order` PR labels

on:
  pull_request:
    types: [labeled]

jobs:
  comment-on-order:
    runs-on: ubuntu-latest
    steps:
      - name: Comment if `order` label and method exist
        uses: actions/github-script@v7
        with:
          script: |
            const { owner, repo } = context.repo;
            const pr = context.payload.pull_request;
            const labels = pr.labels.map(label => label.name.toLowerCase());
            const moduleLabel = 'backoffice';
            const methodLabels = ['get', 'post', 'put', 'delete'];

            if (!labels.includes(moduleLabel)) {
              console.log(moduleLabel + ' ë¼ë²¨ì´ ì—†ëŠ” PRì…ë‹ˆë‹¤. ì¢…ë£Œí•©ë‹ˆë‹¤.');
              return;
            }

            const matchedMethod = methodLabels.find(m => labels.includes(m));
            if (!matchedMethod) {
              console.log('HTTP ë©”ì„œë“œ ë¼ë²¨ì´ ì—†ìŠµë‹ˆë‹¤. ì¢…ë£Œí•©ë‹ˆë‹¤.');
              return;
            }

            const commentBody = `
### ğŸš€ Order PR ì•Œë¦¼

\`${moduleLabel}\`ì— ëŒ€í•œ **\`${matchedMethod.toUpperCase()}\` ìš”ì²­** ë³€ê²½ì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.

- PR: [#${pr.number}](${pr.html_url})
- ë¸Œëœì¹˜: \`${pr.head.ref}\` â†’ \`${pr.base.ref}\`
- ì‘ì„±ì: @${pr.user.login}

ê²€í†  ë¶€íƒë“œë¦½ë‹ˆë‹¤ ğŸ™
`;

            await github.rest.issues.createComment({
              owner,
              repo,
              issue_number: pr.number,
              body: commentBody,
            });

            console.log('ì½”ë©˜íŠ¸ë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.');
